# 开发备忘录

## 项目概述
本项目是一个基于静态图片的地图系统，包含 H5（web）和微信小程序（miniprogram）两个实现版本。两个版本共享相同的地图底图（map.jpg）和坐标系统，确保 Marker 坐标的一致性。

## 开发进度

### H5（Web）版本
**当前状态：基础功能已完成**

**已完成功能：**
- ✅ 基础地图系统实现
- ✅ 图片缩放、拖拽功能
- ✅ 触摸和鼠标事件支持
- ✅ Cover 模式显示（图片铺满屏幕，保持宽高比）
- ✅ 深色背景（#1a1a2e）避免白边
- ✅ 拖拽边界约束，防止图片移出屏幕
- ✅ 缩放边界处理
- ✅ 最小缩放比例为 cover 模式比例，确保图片始终覆盖屏幕

**待开发功能：**
- ⬜ 标记点（Marker）功能
- ⬜ 坐标转换功能
- ⬜ 动态标记点管理
- ⬜ 高级交互功能

### 微信小程序版本
**当前状态：核心功能已完成，标记点功能已实现**

**已完成功能：**
- ✅ 基础地图系统实现（使用 movable-area/movable-view）
- ✅ 图片缩放、拖拽功能
- ✅ 保持与 H5 版本一致的坐标系统
- ✅ 最小缩放比例为初始缩放比例，确保图片始终覆盖屏幕
- ✅ 拖拽边界限制，防止图片滑动到边界外
- ✅ 标记点（Marker）数据结构
- ✅ 标记点渲染（支持图片标记点）
- ✅ 标记点点击事件
- ✅ 底部弹窗展示详细信息
- ✅ 视频观看功能
- ✅ 视频播放组件集成

**标记点功能详情：**
- 支持图片标记点（1.jpeg、2.jpeg、3.jpeg）
- 每个标记点包含：标题、描述、图片、视频地址
- 点击标记点显示底部弹窗，包含：
  - 标题
  - 图片预览
  - 详细描述
  - "点击观看视频"按钮
- 视频播放功能：
  - 全屏视频播放器
  - 支持播放/暂停、全屏、进度控制
  - 手势控制支持

**待开发功能：**
- ⬜ 坐标转换（屏幕坐标 ↔ 地图坐标）
- ⬜ 动态标记点管理（新增/删除）
- ⬜ 标记点视觉大小固定（不随缩放变化）
- ⬜ 高级标记点功能（长按、拖拽）
- ⬜ 性能优化（大量标记点渲染）
- ⬜ 功能增强（搜索、路线规划等）

## 技术规范

### 坐标系统
- **黄金法则**：所有 Marker 坐标必须使用 map.jpg 的原始像素坐标
- **禁止**：存储屏幕坐标、缩放后的坐标、不同端的坐标体系
- **数据结构示例**：
  ```js
  {
    id: "marker-1",
    x: 320, // 原始图片像素 X
    y: 580  // 原始图片像素 Y
  }
  ```

### Transform 模型
两个版本遵循相同的 transform 模型：
- `screenX = marker.x * scale + translateX`
- `screenY = marker.y * scale + translateY`
- transform-origin 必须为 `0 0`

## 近期更新
1. **小程序版本**：
   - 实现了完整的标记点功能
   - 添加了底部信息弹窗
   - 集成了视频播放组件
   - 优化了边界限制和缩放控制

2. **H5 版本**：
   - 基础功能稳定，等待标记点功能移植

## 下一步计划
1. **小程序版本优化**：
   - 实现坐标转换工具函数
   - 添加动态标记点管理功能
   - 优化标记点视觉表现

2. **H5 版本开发**：
   - 移植小程序版本的标记点功能
   - 保持两个版本功能一致性

3. **跨平台协调**：
   - 确保两个版本的 API 设计一致
   - 共享数据结构和工具函数

## 注意事项
- 所有开发必须遵循 AGENTS.md 中的规范
- 保持代码简洁、可维护
- 关键数学/transform 逻辑必须添加注释
- 优先使用平台原生组件，避免不必要的第三方库
